<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minor Selection Survey</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Minor Finder</h1>
    <form id="surveyForm">
        <div>
            <label for="branch">Select your branch:</label>
            <select id="branch" name="branch" required>
                <option value="">Select Branch</option>
                <option value="CSE">CSE</option>
                <option value="MnC">MnC</option>
                <option value="ECE">ECE</option>
                <option value="EEE">EEE</option>
                <option value="ENI">ENI</option>
                <option value="MECHANICAL">MECHANICAL</option>
                <option value="CHEMICAL">CHEMICAL</option>
                <option value="CIVIL">CIVIL</option>
                <option value="PHARMACY">PHARMACY</option>
            </select>
        </div>

        <div>
            <label>Do you like your branch?</label>
            <input type="radio" name="branchLike" value="yes" required> Yes
            <input type="radio" name="branchLike" value="no" required> No
        </div>

        <div>
            <label for="dualBranch">Select your dual branch:</label>
            <select id="dualBranch" name="dualBranch" required>
                <option value="None">None</option>
                <option value="ECONOMICS">ECONOMICS</option>
                <option value="MATHEMATICS">MATHEMATICS</option>
                <option value="CHEMISTRY">CHEMISTRY</option>
                <option value="PHYSICS">PHYSICS</option>
                <option value="BIOLOGY">BIOLOGY</option>
            </select>
        </div>

        <div id="branchRatings">
            <label for="branchRatings">Rate your interest in other branches (0-5):</label>
            <!-- Number inputs for branch ratings will be added here dynamically -->
        </div>

        <div id="opelRatings">
            <label>Rate your interest in OPEL courses (0-5):</label>
            <div>
                <label>Aeronautics:</label>
                <input type="number" name="Aeronautics" min="0" max="5" value="0" required>
            </div>
            <div>
                <label>Entrepreneurship:</label>
                <input type="number" name="Entrepreneurship" min="0" max="5" value="0" required>
            </div>
            <div id="financeDiv">
                <label>Finance:</label>
                <input type="number" name="Finance" min="0" max="5" value="0" required>
            </div>
            <div>
                <label>Material Sciences:</label>
                <input type="number" name="MaterialSciences" min="0" max="5" value="0" required>
            </div>
            <div>
                <label>Robotics and Automation:</label>
                <input type="number" name="RoboticsAndAutomation" min="0" max="5" value="0" required>
            </div>
        </div>

        <button type="submit">Submit</button>
    </form>

    <div id="results" style="display: none;">
        <h2>The top five minors for you to choose are:</h2>
        <ol id="topMinors"></ol>
    </div>

    <script>
        const branchSelect = document.getElementById('branch');
        const dualBranchSelect = document.getElementById('dualBranch');
        const branchRatingsDiv = document.getElementById('branchRatings');
        const financeDiv = document.getElementById('financeDiv');
        const form = document.getElementById('surveyForm');

      function updateBranchRatings() {
    const selectedBranch = branchSelect.value;
    const selectedDualBranch = dualBranchSelect.value;
    const branches = [
        "CSE", "MnC", "ECE", "EEE", "ENI", "MECHANICAL", "CHEMICAL", 
        "CIVIL", "PHARMACY", "ECONOMICS", "MATHEMATICS", "CHEMISTRY", 
        "BIOLOGY", "PHYSICS"
    ];
    
    branchRatingsDiv.innerHTML = '';

    // Create a set of branches to exclude based on selected branch and dual branch
    const excludedBranches = new Set([selectedBranch, selectedDualBranch, "MnC", "PHARMACY"]); // Always exclude MnC and PHARMACY

    branches.forEach(branch => {
        // Only add the branch rating input if it is not in the excludedBranches set
        if (!excludedBranches.has(branch)) {
            const div = document.createElement('div');
            div.innerHTML = `
                <label>${branch}</label><br>
                <input type="number" name="${branch}" min="0" max="5" value="0" required>
            `;
            branchRatingsDiv.appendChild(div);
        }
    });
}

branchSelect.addEventListener('change', updateBranchRatings);

dualBranchSelect.addEventListener('change', (e) => {
    updateBranchRatings(); // Make sure branch ratings are updated when dual branch changes
    financeDiv.style.display = e.target.value === "ECONOMICS" ? 'none' : 'block';
    if (e.target.value === "ECONOMICS") {
        document.querySelector('input[name="Finance"]').value = '0';
    }
});

// Initial update on page load
document.addEventListener('DOMContentLoaded', () => {
    updateBranchRatings();
});

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(form);

    try {
        const response = await fetch('/submit', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('results').style.display = 'block';
            const topMinorsList = document.getElementById('topMinors');
            topMinorsList.innerHTML = '';

            Object.entries(data.top_5_minors).forEach(([minor, score]) => {
                const li = document.createElement('li');
                li.textContent = `${minor} (${score}%)`;
                topMinorsList.appendChild(li);
            });
        } else {
            alert('Error processing form: ' + data.error);
        }
    } catch (error) {
        alert('Error submitting form: ' + error);
    }
});


        // Initial update
        updateBranchRatings();
    </script>
</body>
</html>
